# Code Review

## Проблемы с кодом

### Архитектура
- CartManager наследуется от ConnectorFacade - это плохо, потому что смешивает бизнес-логику с Redis
- Нет нормальных интерфейсов для репозиториев, всё захардкожено
- В конструкторах классов прямые зависимости, надо бы через интерфейсы

### Бизнес-логика
- В CartManager куча всего намешано:
    * работа с корзиной
    * работа с Redis
    * логирование
- Вся логика в контроллерах, это неудобно поддерживать
- Нет отдельного слоя для бизнес-логики

### Ошибки в коде
```php
catch (Exception $e) {
    $this->logger->error('Error');
}
```
- Вот такие логи бесполезны - непонятно что случилось
- Нет стектрейса
- Просто "Error" ни о чем не говорит

### Проблемы с Redis
- Прямая привязка к Redis через наследование - если захотим сменить хранилище, придется переписывать
- Нет TTL для корзины (в ТЗ написано про сутки)
- Нет обработки ошибок Redis

### Сессии
- Везде напрямую session_id() - лучше бы через абстракцию
- Не проверяется валидность сессии

## Что надо сделать

1. Архитектура
    - Сделать интерфейсы для репозиториев
    - Вынести бизнес-логику в сервисы
    - Убрать прямые зависимости

2. Бизнес-логика
    - Перенести создание CartItem в сервис
    - Добавить проверки товаров
    - Сделать нормальную доменную модель

3. Ошибки
    - Добавить нормальные исключения
    - Сделать нормальное логирование с контекстом
    - Обработать ошибки Redis

4. Redis и сессии
    - Добавить TTL
    - Сделать абстракцию для сессий

## Приоритеты
1. Сначала архитектуру поправить
2. Потом бизнес-логику причесать
3. Добавить нормальную обработку ошибок
4. В конце настроить Redis и сессии

P.S. Код почти рабочий, но его надо привести в порядок. Главное разделить на слои и убрать прямые зависимости
